<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.mcx.blog.mapper.web.ArticleCommentMapper">

    <select id="selectPageList" resultType="me.mcx.blog.domain.vo.message.SystemCommentVO">
        SELECT
        c.id,
        au.avatar,
        au.nickname,
        IF(rau.nickname is null,'æ— ',rau.nickname) as replyNickname,
        a.title as articleTitle,
        c.content,
        c.create_time
        FROM
        blog_comment c
        LEFT JOIN ( SELECT id, user_info_id FROM blog_user_userinfo ) uui ON c.user_id = uui.user_id
        LEFT JOIN ( SELECT id, avatar, nickname FROM b_user_info ) au ON uui.user_info_id = au.id
        LEFT JOIN ( SELECT id, title FROM b_article ) a ON c.article_id = a.id
        LEFT JOIN ( SELECT user_id as id, user_info_id FROM blog_user_userinfo ) ru ON c.reply_user_id = ru.user_id
        LEFT JOIN ( SELECT id, avatar, nickname FROM b_user_info ) rau ON ru.user_info_id = rau.id
        <where>
            <if test="keywords != null and keywords != ''">
                au.nickname like concat('%',#{keywords},'%') or rau.nickname like concat('%',#{keywords},'%')
            </if>
        </where>
        order by c.create_time desc
    </select>


    <select id="selectCommentPage" resultType="me.mcx.blog.domain.vo.message.ApiCommentListVO">
        select c.*, c.user_id as userId, ui.nickname as nickname, ui.web_site as webSite, ui.avatar as avatar
        from blog_article_comment c
                 left join `cxblog-cloud`.sys_user u on c.user_id = u.user_id
                 left join blog_user_userinfo uui on uui.user_info_id = u.user_id
                 left join blog_user_info ui on ui.id = uui.user_info_id
        where c.article_id = #{articleId}
          and c.parent_id is null
        order by c.create_time desc
    </select>

    <select id="selectMyComment" resultType="me.mcx.blog.domain.vo.article.ApiArticleListVO">
        select c.content as commentContent,c.create_time,a.title,a.id
        from blog_article_comment c left join blog_article a on c.article_id = a.id where c.user_id = #{userId} order by c.create_time desc
    </select>

</mapper>
