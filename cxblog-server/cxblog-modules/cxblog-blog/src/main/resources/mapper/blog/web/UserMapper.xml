<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.mcx.blog.mapper.web.UserMapper">
    <select id="selectByUserName" resultType="me.mcx.blog.domain.vo.user.UserInfoVO">
        select a.id,a.login_type,a.status,b.nickname,b.avatar,b.email,b.intro,b.web_site from `cxblog-cloud`.sys_user a
            left join (select id,nickname,avatar,email,intro,web_site from blog_user_info) b on a.user_info_id=b.id
        where username=#{username}
    </select>
    <select id="selectInfoByUserId" resultType="me.mcx.blog.domain.vo.user.UserInfoVO">
        SELECT
            u.user_id as id,
            ui.nickname,
            ui.avatar,
            ui.intro,
            ui.web_site,
            ui.bj_cover,
            count( DISTINCT a.id ) AS articleCount,
            count( DISTINCT fans.id ) AS fansCount,
            count( DISTINCT watch.id ) AS watchCount
        FROM
            `cxblog-cloud`.sys_user u
                LEFT JOIN blog_user_userinfo uui ON uui.user_id = u.user_id
                LEFT JOIN blog_user_info ui ON uui.user_info_id = ui.id
                LEFT JOIN blog_article a ON u.user_id = a.user_id
                LEFT JOIN blog_followed fans on fans.followed_user_id = u.user_id
                LEFT JOIN blog_followed watch on watch.user_id = u.user_id
        WHERE u.user_id = #{userId} group by u.user_id
    </select>

    <select id="selectInfoByUserIdTwo" resultType="me.mcx.blog.domain.vo.user.UserInfoVO">
        SELECT
            u.user_id as id,
            ui.nickname,
            ui.avatar,
            ui.intro,
            ui.web_site,
            ui.bj_cover
        FROM
            `cxblog-cloud`.sys_user u
                LEFT JOIN blog_user_userinfo uui ON uui.user_id = u.user_id
                LEFT JOIN blog_user_info ui ON uui.user_info_id = ui.id
        WHERE u.user_id = #{userId} group by u.user_id
    </select>

    <select id="selectInfoByUserIdNew" resultType="me.mcx.blog.domain.vo.user.UserInfoVO">
        SELECT
            u.user_id as id,
            uui.user_info_id as userInfoId,
            ui.nickname,
            ui.avatar,
            ui.intro,
            ui.web_site as webSite,
            ui.bj_cover as bjCover
        FROM
            `cxblog-cloud`.sys_user u
                LEFT JOIN blog_user_userinfo uui ON uui.user_id = u.user_id
                LEFT JOIN blog_user_info ui ON uui.user_info_id = ui.id
        WHERE u.user_id = #{userId} group by u.user_id
    </select>
</mapper>
